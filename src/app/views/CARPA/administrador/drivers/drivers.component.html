<!-- Drivers view: Conexiones / Drivers -->
<div class="card">
	<div class="card-header">
		<h6 class="card-title fw-semibold mb-0">Administrador / Conexiones / Drivers</h6>
	</div>
	<div class="card-body" style="position: relative;">
		<app-local-loading [loading]="loading"></app-local-loading>
		<div class="row mb-4 align-items-end">
			<div class="fw-bold d-flex justify-content-end">
				<strong>Total de registros:</strong> {{ driversFiltrados.length || 0 }}
			</div>
		</div>
		<div class="d-flex justify-content-between mb-4">
			<div class="d-flex gap-3">
				<button class="btn btn-success" (click)="openAddDriverModal(addDriverModal)">
					<i class="mdi mdi-plus"></i> Agregar
				</button>
			</div>
			<div>
				<input type="text" class="form-control" style="width: 260px; display: inline-block;"
					placeholder="Buscar..." [(ngModel)]="searchTerm" (input)="filtrarDrivers()">
			</div>
		</div>
		<div class="table-responsive">
			<table class="table table-bordered text-center align-middle">
				<thead class="table-light">
		    <tr>
			<!-- <th>Eliminar</th> -->
			<th class="fw-semibold"><!-- No model field, acción de edición -->Editar</th>
			<th (click)="ordenarPor('connectionName')" style="cursor:pointer" class="fw-semibold">
				Nombre de Conexión
				<span *ngIf="sortColumn === 'connectionName'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('datasourceType')" style="cursor:pointer" class="fw-semibold">
				Tipo de Fuente
				<span *ngIf="sortColumn === 'datasourceType'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('jdbcUrl')" style="cursor:pointer" class="fw-semibold">
				URL JDBC
				<span *ngIf="sortColumn === 'jdbcUrl'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('username')" style="cursor:pointer" class="fw-semibold">
				Usuario
				<span *ngIf="sortColumn === 'username'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('driverClassName')" style="cursor:pointer" class="fw-semibold">
				Driver Class
				<span *ngIf="sortColumn === 'driverClassName'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('profile')" style="cursor:pointer" class="fw-semibold">
				Perfil
				<span *ngIf="sortColumn === 'profile'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
			<th (click)="ordenarPor('enabled')" style="cursor:pointer" class="fw-semibold">
				Status
				<span *ngIf="sortColumn === 'enabled'">
					<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
				</span>
			</th>
		    </tr>
				</thead>
				<tbody>
					<tr *ngFor="let d of driversPaginados">
						<td>
							<button class="btn btn-sm btn-warning" (click)="openEditDriverModal(addDriverModal, d)"><i class="feather icon-edit"></i></button>
						</td>
						<!-- d.connectionName = columna Nombre de Conexión -->
						<td>{{ d.connectionName }}</td>
						<!-- d.datasourceType = columna Tipo de Fuente -->
						<td>{{ d.datasourceType }}</td>
						<!-- d.jdbcUrl = columna URL JDBC -->
						<td class="text-start">{{ d.jdbcUrl }}</td>
						<!-- d.username = columna Usuario -->
						<td>{{ d.username }}</td>
						<!-- d.driverClassName = columna Driver Class -->
						<td>{{ d.driverClassName }}</td>
						<!-- d.profile = columna Perfil -->
						<td>{{ d.profile }}</td>
						<!-- d.enabled = columna Status -->
						<td>
							<span class="badge" [ngClass]="d.enabled ? 'bg-success text-white' : 'bg-danger text-white'">{{ d.enabled ? 'Activo' : 'Inactivo' }}</span>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Paginador -->
		<div class="d-flex justify-content-between align-items-center mt-3">
			<div class="d-flex align-items-center gap-2">
				<select class="form-select" style="width:auto;display:inline-block" [(ngModel)]="pageSize"
					(change)="cambiarPageSize(pageSize)">
					<option [ngValue]="5">5</option>
					<option [ngValue]="10">10</option>
					<option [ngValue]="25">25</option>
				</select>
				<label class="me-2 mb-0">registros por página</label>
			</div>
			<ul class="pagination mb-0">
				<li class="page-item" [class.disabled]="page === 1"><button class="page-link"
						(click)="cambiarPagina(page - 1)">Anterior</button></li>
				<li class="page-item" [class.active]="page === 1"><button class="page-link"
						(click)="cambiarPagina(1)">1</button></li>
				<ng-container *ngFor="let p of [page-2, page-1, page, page+1, page+2]">
					<li class="page-item" *ngIf="p > 1 && p < totalPages" [class.active]="page === p"><button
							class="page-link" (click)="cambiarPagina(p)">{{ p }}</button></li>
				</ng-container>
				<li class="page-item" [class.disabled]="page === totalPages"><button class="page-link"
						(click)="cambiarPagina(page + 1)">Siguiente</button></li>
			</ul>
		</div>
	</div>
</div>

<!-- Modal para agregar/editar driver -->
<ng-template #addDriverModal let-modal>
	<div class="modal-header">
		<h5 class="modal-title fw-semibold">{{ modalModo === 'agregar' ? 'Nuevo Driver' : 'Editar Driver' }}</h5>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.close()"></button>
	</div>
	<form (ngSubmit)="saveDriver(modal)">
	<div class="modal-body" autocomplete="off">
			<div class="mb-3">
				<label class="form-label">Nombre de Conexión</label>
				<input class="form-control" [(ngModel)]="newDriver.connectionName" name="connectionName" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Tipo de Fuente</label>
				<input class="form-control" [(ngModel)]="newDriver.datasourceType" name="datasourceType" required>
			</div>
			<div class="mb-3">
				<label class="form-label">URL JDBC</label>
				<input class="form-control" [(ngModel)]="newDriver.jdbcUrl" name="jdbcUrl" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Usuario</label>
				<input class="form-control" [(ngModel)]="newDriver.username" name="username" autocomplete="new-username" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Contraseña</label>
				<input class="form-control" [(ngModel)]="newDriver.password" name="password" type="password" autocomplete="new-password">
			</div>
			<div class="mb-3">
				<label class="form-label">Driver Class</label>
				<input class="form-control" [(ngModel)]="newDriver.driverClassName" name="driverClassName" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Perfil</label>
				<input class="form-control" [(ngModel)]="newDriver.profile" name="profile" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Status</label>
				<select class="form-select" [(ngModel)]="newDriver.enabled" name="enabled">
					<option [ngValue]="true">Activo</option>
					<option [ngValue]="false">Inactivo</option>
				</select>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-success" type="submit">{{ modalModo === 'agregar' ? 'Agregar' : 'Guardar' }}</button>
			<button type="button" class="btn btn-secondary" (click)="modal.close()">Cerrar</button>
		</div>
	</form>
</ng-template>