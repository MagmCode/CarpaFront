<!-- Equipos view: similar a Drivers -->
<div class="card">
	<div class="card-header">
		<h6 class="card-title fw-semibold mb-0">Conexiones / Equipos</h6>
	</div>
	<div class="card-body" style="position: relative;">
		<app-local-loading [loading]="loading"></app-local-loading>
		<div class="row mb-4 align-items-end">
			<div class="fw-bold d-flex justify-content-end">
				<strong>Total de registros:</strong> {{ equiposFiltrados.length || 0 }}
			</div>
		</div>
		<div class="d-flex justify-content-between mb-4">
			<div class="d-flex gap-3">
				<button class="btn btn-success" (click)="openAddEquipoModal(addEquipoModal)">
					<i class="mdi mdi-plus"></i> Agregar
				</button>
			</div>
			<div>
				<input type="text" class="form-control" style="width: 260px; display: inline-block;"
					placeholder="Buscar..." [(ngModel)]="searchTerm" (input)="filtrarEquipos()">
			</div>
		</div>
		<div class="table-responsive">
					<table class="table table-bordered text-center align-middle">
						<thead class="table-light">
							<tr>
								<!-- <th>Eliminar</th> -->
								<th class="fw-semibold">Editar</th>
								<th (click)="ordenarPor('host')" style="cursor:pointer" class="fw-semibold">
									Host/IP
									<span *ngIf="sortColumn === 'host'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
								<th (click)="ordenarPor('mac')" style="cursor:pointer" class="fw-semibold">
									MAC Address
									<span *ngIf="sortColumn === 'mac'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
								<th (click)="ordenarPor('type')" style="cursor:pointer" class="fw-semibold">
									Tipo de Dispositivo
									<span *ngIf="sortColumn === 'type'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
								<th (click)="ordenarPor('identifier')" style="cursor:pointer" class="fw-semibold">
									Identificador
									<span *ngIf="sortColumn === 'identifier'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
								<th (click)="ordenarPor('description')" style="cursor:pointer" class="fw-semibold">
									Descripci칩n
									<span *ngIf="sortColumn === 'description'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
								<th (click)="ordenarPor('status')" style="cursor:pointer" class="fw-semibold">
									Status
									<span *ngIf="sortColumn === 'status'">
										<i class="feather" [ngClass]="{'icon-arrow-up': sortDirection === 'asc', 'icon-arrow-down': sortDirection === 'desc'}"></i>
									</span>
								</th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let e of equiposPaginados">
								<td>
									<button class="btn btn-sm btn-warning" (click)="openEditEquipoModal(addEquipoModal, e)"><i class="feather icon-edit"></i></button>
								</td>
								<td>{{ e.host }}</td>
								<td>{{ e.mac }}</td>
								<td>{{ e.type }}</td>
								<td>{{ e.identifier }}</td>
								<td class="text-start">{{ e.description }}</td>
								<td>
									<span class="badge"
										[ngClass]="e.status === '1' ? 'bg-success text-white' : 'bg-danger text-white'">{{ e.status === '1' ? 'Activo' : (e.status === '0' ? 'Inactivo' : e.status) }}</span>
								</td>
							</tr>
						</tbody>
					</table>
		</div>
		<!-- Paginador -->
		<div class="d-flex justify-content-between align-items-center mt-3">
			<div class="d-flex align-items-center gap-2">
				<select class="form-select" style="width:auto;display:inline-block" [(ngModel)]="pageSize"
					(change)="cambiarPageSize(pageSize)">
					<option [ngValue]="5">5</option>
					<option [ngValue]="10">10</option>
					<option [ngValue]="25">25</option>
				</select>
				<label class="me-2 mb-0">registros por p치gina</label>
			</div>
			<ul class="pagination mb-0">
				<li class="page-item" [class.disabled]="page === 1"><button class="page-link"
						(click)="cambiarPagina(page - 1)">Anterior</button></li>
				<li class="page-item" [class.active]="page === 1"><button class="page-link"
						(click)="cambiarPagina(1)">1</button></li>
				<ng-container *ngFor="let p of [page-2, page-1, page, page+1, page+2]">
					<li class="page-item" *ngIf="p > 1 && p < totalPages" [class.active]="page === p"><button
							class="page-link" (click)="cambiarPagina(p)">{{ p }}</button></li>
				</ng-container>
				<li class="page-item" [class.disabled]="page === totalPages"><button class="page-link"
						(click)="cambiarPagina(page + 1)">Siguiente</button></li>
			</ul>
		</div>
	</div>
</div>

<!-- Modal para agregar/editar equipo -->
<ng-template #addEquipoModal let-modal>
	<div class="modal-header">
		<h5 class="modal-title">{{ modalModo === 'agregar' ? 'Nuevo Equipo' : 'Editar Equipo' }}</h5>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.close()"></button>
	</div>
	<form (ngSubmit)="saveEquipo(modal)">
		<div class="modal-body">
			<div class="mb-3">
				<label class="form-label">Direcci칩n Host/IP</label>
				<input class="form-control" [(ngModel)]="newEquipo.host" name="host" required>
			</div>
			<div class="mb-3">
				<label class="form-label">MAC Address</label>
				<input class="form-control" [(ngModel)]="newEquipo.mac" name="mac" required>
			</div>
			<div class="mb-3">
				<label class="form-label">Descripci칩n</label>
				<input class="form-control" [(ngModel)]="newEquipo.description" name="description" [appAlphanumeric]="true">
			</div>
			<div class="mb-3">
				<label class="form-label">Identificador</label>
				<input class="form-control" [(ngModel)]="newEquipo.identifier" name="identifier" required [appAlphanumeric]="true">
			</div>
			<div class="mb-3">
				<label class="form-label">Dispositivo</label>
				<select class="form-select" [(ngModel)]="newEquipo.type" name="type" required>
					<option [ngValue]="null" disabled selected>Seleccione...</option>
					<option [ngValue]="'PC'">PC</option>
					<option [ngValue]="'Laptop'">Laptop</option>
					<option [ngValue]="'Servidor'">Servidor</option>
					<option [ngValue]="'Impresora'">Impresora</option>
					<option [ngValue]="'Otro'">Otro</option>
				</select>
			</div>
			<div class="mb-3">
				<label class="form-label">Status</label>
				<select class="form-select" [(ngModel)]="newEquipo.status" name="status">
					<option [ngValue]="null" disabled selected>Seleccione...</option>
					<option [ngValue]="'Activo'">Activo</option>
					<option [ngValue]="'Inactivo'">Inactivo</option>
				</select>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-success" type="submit">{{ modalModo === 'agregar' ? 'Agregar' : 'Guardar' }}</button>
			<button type="button" class="btn btn-secondary" (click)="modal.close()">Cerrar</button>
		</div>
	</form>
</ng-template>
