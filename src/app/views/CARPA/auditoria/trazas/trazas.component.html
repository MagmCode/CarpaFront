<div class="card">
	<div class="card-header">
		<h6 class="card-title fw-semibold">Auditoría / Trazas</h6>
	</div>
	<div class="card-body" style="position: relative;">
		<div class="row mb-4 align-items-end">
			<div class="d-flex justify-content-end">
				<strong>Total de registros:&nbsp;</strong>  {{ trazasFiltradas.length }}
			</div>
		</div>

		<div class="d-flex justify-content-between mb-4">
			<div class="d-flex gap-3">
				<button class="btn btn-success" (click)="openAddModal(trazaModal)">
					<i class="mdi mdi-plus"></i> Agregar
				</button>
			</div>
			<div>
				<input type="text" class="form-control" style="width: 250px; display: inline-block;" placeholder="Buscar..."
					[(ngModel)]="searchTerm" (input)="filtrarTrazas()">
			</div>
		</div>

		<div class="table-responsive">
			<table class="table table-bordered text-center align-middle">
				<thead class="table-light">
					<tr>
						<th>Eliminar</th>
						<th>Editar</th>
						<th>URL</th>
						<th>Auditable</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let t of trazasPaginadas">
						<td>
							<button class="btn btn-danger btn-sm" (click)="deleteTraza(t)">
								<i class="feather icon-trash-2"></i>
							</button>
						</td>
						<td>
							<button class="btn btn-warning btn-sm" (click)="openEditModal(trazaModal, t)">
								<i class="feather icon-edit"></i>
							</button>
						</td>
						<td class="text-start text-truncate" style="max-width:400px;">{{ t.url }}</td>
						<td>
							<span class="badge" [ngClass]="t.auditable ? 'bg-success' : 'bg-secondary'">{{ t.auditable ? 'Sí' : 'No' }}</span>
						</td>
					</tr>
				</tbody>
			</table>

			<!-- Paginación -->
			<nav>
				<div class="d-flex justify-content-between align-items-center mt-3">
					<div class="d-flex align-items-center gap-2">
						<select class="form-select" style="width:auto;display:inline-block" [(ngModel)]="pageSize" (change)="cambiarPageSize(pageSize)">
							<option [ngValue]="5">5</option>
							<option [ngValue]="10">10</option>
							<option [ngValue]="25">25</option>
							<option [ngValue]="50">50</option>
						</select>
						<label class="me-2 mb-0">registros por página</label>
					</div>
					<ul class="pagination mb-0">
						<li class="page-item" [class.disabled]="page === 1">
							<button class="page-link" (click)="cambiarPagina(page - 1)">Anterior</button>
						</li>
						<li class="page-item" [class.active]="page === 1">
							<button class="page-link" (click)="cambiarPagina(1)">1</button>
						</li>
						<li class="page-item disabled" *ngIf="page > 4">
							<span class="page-link">...</span>
						</li>
						<ng-container *ngFor="let p of [page-2, page-1, page, page+1, page+2]">
							<li class="page-item" *ngIf="p > 1 && p < totalPages" [class.active]="page === p">
								<button class="page-link" (click)="cambiarPagina(p)">{{ p }}</button>
							</li>
						</ng-container>
						<li class="page-item disabled" *ngIf="page < totalPages - 3">
							<span class="page-link">...</span>
						</li>
						<li class="page-item" *ngIf="totalPages > 1" [class.active]="page === totalPages">
							<button class="page-link" (click)="cambiarPagina(totalPages)">{{ totalPages }}</button>
						</li>
						<li class="page-item" [class.disabled]="page === totalPages">
							<button class="page-link" (click)="cambiarPagina(page + 1)">Siguiente</button>
						</li>
					</ul>
				</div>
			</nav>
		</div>
	</div>
</div>

<!-- Modal para añadir/editar traza -->
<ng-template #trazaModal let-modal>
	<div class="modal-header">
		<h5 class="modal-title">{{ modalMode === 'add' ? 'Agregar Traza' : 'Editar Traza' }}</h5>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.close()"></button>
	</div>
	<form (ngSubmit)="saveTraza(modal)">
		<div class="modal-body">
			<div class="mb-3">
				<label class="form-label">URL</label>
				<input class="form-control" [(ngModel)]="trazaSeleccionada.url" name="url" required>
			</div>
			<div class="form-check mb-3">
				<input class="form-check-input" type="checkbox" id="auditable" [(ngModel)]="trazaSeleccionada.auditable" name="auditable">
				<label class="form-check-label" for="auditable">Auditable</label>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-success" type="submit">Guardar</button>
			<button class="btn btn-secondary" type="button" (click)="modal.close()">Cerrar</button>
		</div>
	</form>
</ng-template>
